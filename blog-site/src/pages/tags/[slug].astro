---
import Layout from "@layouts/Base.astro";
import PostList from "@components/PostList.astro";
import { CollectionEntry, getCollection } from "astro:content";
import uniqueTags from "@utils/uniqueTags";
import sortedPosts from "@utils/sortedPosts";

export async function getStaticPaths() {
    const posts = await getCollection("blog", ({ data }) => !data.draft);
    const tags = uniqueTags(posts);
    const tagResult = Array.from(tags.keys()).map((tagName) => ({
        params: { slug: tagName },
        props: {
            posts: posts.filter((post) => {
                return post.data.tags.includes(tagName);
            }),
            tagName: tagName,
        },
    }));
    return [...tagResult];
}

export interface Props {
    posts: CollectionEntry<"blog">[];
    tagName: string;
}

let { posts, tagName } = Astro.props;
posts = sortedPosts(posts);
---

<Layout>
    <PostList title={tagName} posts={posts} />
</Layout>
